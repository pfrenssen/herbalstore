language: php
dist: bionic
sudo: false

cache:
  directories:
    - $HOME/.composer/cache/files

php:
  - 7.2

env:
  global:
    - COMPOSER_MEMORY_LIMIT=2G
    - BASE_URL="http://localhost:8888"
    - SCREENSHOTS_PATH="/tmp"
    # Todo: install Selenium.
    - WEBDRIVER_HOST="http://127.0.0.1:4444"
    - MYSQL_DATABASE=drupal
    - MYSQL_HOSTNAME=127.0.0.1
    - MYSQL_PORT=3306
    - MYSQL_USER=root

mysql:
  database: herbalstore
  username: root
  encoding: utf8

services:
  - mysql

install:
  - composer --verbose install
  - ls web/sites/default/ -l
  - cp resources/travis-ci/settings.php web/sites/default/
  - ls web/sites/default/ -l
  - find web/sites/default/ -type f | xargs tail -n +1
  - ./vendor/bin/robo dev:setup
  - cat drush/drush.yml
  - cat behat.yml
  - ./vendor/bin/drush sql-create --yes
  - ./vendor/bin/drush site:install --existing-config --db-url=mysql://root@localhost/herbalstore --yes -vvv

before_script:
  # Start the PHP web server and wait for it to come online.
  - ./vendor/bin/drush runserver :8888 &> /dev/null &
  - until curl -s localhost:8888; do true; done > /dev/null

script:
  - ./vendor/bin/behat
